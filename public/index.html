<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fighting Fantasy</title>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js"></script>
  <script 
    src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.min.js" 
    integrity="sha384-ZBXiYtYQ6hJ2Y0ZNoYuI+Nq5MqWBr+chMrS/RkXpNzQCApHEhOt2aY8EJgqwHLkJ" 
    crossorigin="anonymous"
  >
  </script>
  <link rel="stylesheet" href="static/style.css"> 
</head>
<body 
  x-data="{
    character: null,
    currentNode: 'character-creation',

    createCharacter(name, skill, stamina, luck, potion) {
      this.character = {
        name: name,
        skill: skill,
        stamina: stamina,
        luck: luck,
        currentSkill: skill,
        currentStamina: stamina,
        currentLuck: luck,
        potions: [potion],
        equipment: [],
        jewels: [],
        provisions: 10,
        equipment: [],
        gold: 0
      };
      this.saveGame();
      htmx.ajax('GET', `/background.html`, {target: 'main', swap: 'innerHTML'});
    },

    navigateTo(nodeId) {
      this.currentNode = nodeId;
      htmx.ajax('GET', `/nodes/${nodeId}.html`, {target: 'main', swap: 'innerHTML'});
    },

    rollDie() {
      return Math.floor(Math.random() * 6) + 1;
    },

    rollDice() {
      return this.rollDie() + this.rollDie();
    },

    testLuck() {
      const roll = rollDice(2);
      const isLucky = roll <= this.character.currentLuck;
      this.character.currentLuck = Math.max(0, this.character.currentLuck - 1);
      this.saveGame();
      return { isLucky, roll: roll.total };
    },

    adjustStat(stat, amount) {
      this.character[stat] = Math.max(0, this.character[stat] + amount);
      this.saveGame();
    },

    saveGame() {
      localStorage.setItem('ff-character', JSON.stringify(this.character));
      localStorage.setItem('ff-current-node', this.currentNode);
      localStorage.setItem('ff-current-page', this.currentPage);
    },

    newGame() {
      localStorage.clear();
      this.character = {};
      this.currentNode = 'character-creation';
      this.showMenu = false;
      htmx.ajax('GET', '/');
    },

    toggleSidebar () { 
      $refs.asidePopoverNav.togglePopover(); 
    }
  }"
>
  <header class="site-header">
    <button popovertarget="aside-popover-nav" popovertargetaction="toggle">
        â˜° Menu
    </button>
    
    <h1>Caverns of The Snow Witch</h1>
    
  </header>
  
  <aside 
    id="aside-popover-nav" 
    hx-get="/aside.html" 
    hx-trigger="load once" 
    hx-swap="outerHTML"
    >
  </aside>

  <main hx-boost="true">
    <article
      hx-get="/character-creation.html" 
      hx-trigger="load once" 
      hx-swap="outerHTML"
      >
    </article>
  </main>    
  
  <footer>
    <p>Research Project made in fair use.</p>
  </footer>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fighting Fantasy</title>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js"></script>
  <script 
    src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.min.js" 
    integrity="sha384-ZBXiYtYQ6hJ2Y0ZNoYuI+Nq5MqWBr+chMrS/RkXpNzQCApHEhOt2aY8EJgqwHLkJ" 
    crossorigin="anonymous"
  >
  </script>
  <link rel="stylesheet" href="style.css"> 
</head>
<body 
  x-data="{
    character: null,
    currentNode: 'character-creation',

    createCharacter(name, skill, stamina, luck, potion) {
      this.character = {
        name: name,
        skill: skill,
        stamina: stamina,
        luck: luck,
        currentSkill: skill,
        currentStamina: stamina,
        currentLuck: luck,
        potions: [potion],
        equipment: [],
        jewels: [],
        provisions: 10,
        equipment: [],
        gold: 0
      };
      this.saveGame();
      this.navigateTo('background');
    },

    navigateTo(nodeId) {
      this.currentNode = nodeId;
      htmx.ajax('GET', `/nodes/${nodeId}.html`, {target: 'main', swap: 'innerHTML'});
    },

    rollDie() {
      return Math.floor(Math.random() * 6) + 1;
    },

    rollDice() {
      return this.rollDie() + this.rollDie();
    },

    testLuck() {
      const roll = rollDice(2);
      const isLucky = roll <= this.character.currentLuck;
      this.character.currentLuck = Math.max(0, this.character.currentLuck - 1);
      this.saveGame();
      return { isLucky, roll: roll.total };
    },

    adjustStat(stat, amount) {
      this.character[stat] = Math.max(0, this.character[stat] + amount);
      this.saveGame();
    },

    saveGame() {
      localStorage.setItem('ff-character', JSON.stringify(this.character));
      localStorage.setItem('ff-current-node', this.currentNode);
      localStorage.setItem('ff-current-page', this.currentPage);
    },

    newGame() {
      localStorage.clear();
      this.character = {};
      this.currentNode = 'character-creation';
      this.showMenu = false;
      htmx.ajax('GET', '/');
    },

    toggleSidebar () { 
      $refs.asidePopoverNav.togglePopover(); 
    }
  }"
>
  <header>
    <button popovertarget="aside-popover-nav" popovertargetaction="toggle">
        ☰ Menu
    </button>

    <h1>Caverns of The Snow Witch</h1>

    <button>I</button>
  </header>
  
  <aside id="aside-popover-nav" popover x-ref="asidePopoverNav">
    <header class="sidebar-header">
      <h3>Navigation</h3>

      <button popovertarget="aside-popover-nav" popovertargetaction="toggle">
        × Close
      </button>
    </header>

    <nav>
      <ul hx-boost="true">
        <li>
          <a
            x-bind:hx-get="currentNode = 'character-creation' ? `/character-creation.html` : `/nodes/${currentNode}.html`"
            hx-target="main"
            @click="toggleSidebar()"
          >
            Current Scene
          </a>
        </li>

        <h4>Rules</h4>
        
        <li>
          <a 
            hx-get="/rules/fighting-monsters.html" 
            hx-target="main" 
            @click="toggleSidebar()"
          >
            Fighting Monsters
          </a>
        </li>

        <li>
          <a 
            hx-get="/rules/equipment-and-potions.html" 
            hx-target="main"
            @click="toggleSidebar()"
          >
            Equipment & Potions
          </a>
        </li>

        <li>
          <a 
            hx-get="/rules/hints-on-play.html"
            hx-target="main"
            @click="toggleSidebar()"
          >
            Hints On Play
          </a>
        </li>

        <li>
          <a 
            hx-get="/nodes/background.html"
            hx-target="main"
            @click="toggleSidebar()"
          >
            Background
          </a>
        </li>
      </ul>
    </nav>

    <template x-if="character">
      <article>
        <h4>Adventure Sheet</h4>

        <div>
          <b>NAME</b>
          <span x-text="character.name"></span>
        </div>

        <div>
          <b>SKILL</b>
          <span>
            <i>Initial</i>
            <span x-text="character.skill"></span>
          </span>

          <span>
            <i>Current</i>
            <span x-text="character.currentSkill"></span>
          </span>
        </div>

          <div>
          <b>STAMINA</b>
          <span>
            <i>Initial</i>
            <span x-text="character.stamina"></span>
          </span>

          <span>
            <i>Current</i>
            <span x-text="character.currentStamina"></span>
          </span>
        </div>

        <div>
          <b>LUCK</b>
          <span>
            <i>Initial</i>
            <span x-text="character.luck"></span>
          </span>

          <span>
            <i>Current</i>
            <span x-text="character.currentLuck"></span>
          </span>
        </div>

        <div>
          <b>GOLD</b>
          <span x-text="character.gold"></span>
        </div>

        <div>
          <b>PROVISIONS</b>
          <span x-text="character.provisions"></span>
          <button type="button">Eat</button>
        </div>

        <div>
          <b>JEWELS</b>
          <span x-text="character.jewels.join(', ')"></span>
        </div>

        <div>
          <b>POTIONS</b>
          <span x-text="character.potions.join(', ')"></span>
        </div>

        <div>
          <b>Equipment</b>
          <span x-text="character.equipment.join(', ')"></span>
        </div>

      </article>
    </template>
  </aside>

  <main hx-boost="true">
    <article
      hx-get="/character-creation.html" 
      hx-trigger="load once" 
      hx-swap="outerHTML"
      >
    </article>
  </main>    
  
  <footer>
      <p>&copy; 2025 Fighting Fantasy.</p>
  </footer>
</body>
</html>